<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CMK 250 Mahkeme Kararlarƒ± Y√∂netim Sistemi</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #1a252f 0%, #2c3e50 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        header p {
            opacity: 0.9;
            font-size: 1.2em;
        }

        .nav-tabs {
            display: flex;
            background: #34495e;
            padding: 0;
            margin: 0;
        }

        .nav-tab {
            flex: 1;
            padding: 15px 20px;
            background: #34495e;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 1.1em;
            transition: all 0.3s;
            border-right: 1px solid #2c3e50;
        }

        .nav-tab:hover {
            background: #2c3e50;
        }

        .nav-tab.active {
            background: #3498db;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .controls {
            padding: 25px;
            background: #ecf0f1;
            border-bottom: 2px solid #bdc3c7;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .search-box {
            flex: 1;
            min-width: 300px;
        }

        .search-box input {
            width: 100%;
            padding: 12px 20px;
            border: 2px solid #bdc3c7;
            border-radius: 25px;
            font-size: 1em;
            transition: all 0.3s;
        }

        .search-box input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .filter-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        select {
            padding: 10px 15px;
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            font-size: 0.95em;
            cursor: pointer;
            background: white;
            transition: all 0.3s;
        }

        select:focus {
            outline: none;
            border-color: #3498db;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .btn-primary {
            background: #3498db;
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }

        .btn-success {
            background: #27ae60;
            color: white;
        }

        .btn-success:hover {
            background: #229954;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .stat-card h3 {
            font-size: 1.2em;
            margin-bottom: 10px;
            opacity: 0.9;
        }

        .stat-card .value {
            font-size: 2.5em;
            font-weight: bold;
        }

        .decisions-grid {
            display: grid;
            gap: 20px;
        }

        .decision-card {
            background: white;
            border: 2px solid #ecf0f1;
            border-radius: 10px;
            padding: 25px;
            transition: all 0.3s;
            cursor: pointer;
        }

        .decision-card:hover {
            border-color: #3498db;
            box-shadow: 0 5px 20px rgba(52, 152, 219, 0.2);
            transform: translateY(-3px);
        }

        .decision-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid #ecf0f1;
        }

        .decision-title {
            flex: 1;
        }

        .decision-title h3 {
            color: #2c3e50;
            font-size: 1.4em;
            margin-bottom: 5px;
        }

        .decision-title p {
            color: #7f8c8d;
            font-size: 0.95em;
        }

        .badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            white-space: nowrap;
        }

        .badge-success {
            background: #d4edda;
            color: #155724;
        }

        .badge-danger {
            background: #f8d7da;
            color: #721c24;
        }

        .badge-warning {
            background: #fff3cd;
            color: #856404;
        }

        .badge-info {
            background: #d1ecf1;
            color: #0c5460;
        }

        .decision-body {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .info-group {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
        }

        .info-group label {
            display: block;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 5px;
            font-size: 0.9em;
        }

        .info-group .value {
            color: #34495e;
            font-size: 1em;
        }

        .decision-details {
            display: none;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #ecf0f1;
        }

        .decision-details.expanded {
            display: block;
        }

        .details-section {
            margin-bottom: 20px;
        }

        .details-section h4 {
            color: #2c3e50;
            font-size: 1.2em;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 2px solid #3498db;
        }

        .details-content {
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-top: 10px;
        }

        .details-content p {
            margin-bottom: 10px;
            line-height: 1.6;
        }

        .details-content ul {
            list-style-position: inside;
            line-height: 1.8;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            max-width: 900px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            padding: 25px;
            background: #2c3e50;
            color: white;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h2 {
            font-size: 1.8em;
        }

        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 2em;
            cursor: pointer;
            padding: 0;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s;
        }

        .close-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .modal-body {
            padding: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 1em;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-group.required label::after {
            content: ' *';
            color: #e74c3c;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #f5c6cb;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #c3e6cb;
        }

        .no-results {
            text-align: center;
            padding: 60px 20px;
            color: #7f8c8d;
        }

        .no-results i {
            font-size: 4em;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        @media (max-width: 768px) {
            .controls {
                flex-direction: column;
                align-items: stretch;
            }

            .search-box {
                min-width: 100%;
            }

            .filter-group {
                flex-direction: column;
                width: 100%;
            }

            .filter-group select {
                width: 100%;
            }

            .decision-body {
                grid-template-columns: 1fr;
            }

            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>‚öñÔ∏è CMK 250 Mahkeme Kararlarƒ± Y√∂netim Sistemi</h1>
            <p>Uzla≈ütƒ±rma Kapsamƒ±ndaki √ñrnek Mahkeme H√ºk√ºmleri</p>
        </header>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('view')">üìã Kararlarƒ± G√∂r√ºnt√ºle</button>
            <button class="nav-tab" onclick="switchTab('add')">‚ûï Yeni Karar Ekle</button>
            <button class="nav-tab" onclick="switchTab('stats')">üìä ƒ∞statistikler</button>
        </div>

        <!-- View Tab -->
        <div id="view-tab" class="tab-content active">
            <div class="controls">
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="üîç Karar ara... (dosya numarasƒ±, isim, su√ß t√ºr√º)" oninput="filterDecisions()">
                </div>
                <div class="filter-group">
                    <select id="mediationFilter" onchange="filterDecisions()">
                        <option value="all">T√ºm Sonu√ßlar</option>
                        <option value="success">Ba≈üarƒ±lƒ± Uzla≈ütƒ±rma</option>
                        <option value="failed">Ba≈üarƒ±sƒ±z Uzla≈ütƒ±rma</option>
                    </select>
                    <select id="categoryFilter" onchange="filterDecisions()">
                        <option value="all">T√ºm Kategoriler</option>
                    </select>
                    <button class="btn btn-primary" onclick="loadDecisions()">üîÑ Yenile</button>
                </div>
            </div>
            <div style="padding: 30px;">
                <div id="decisionsContainer" class="decisions-grid"></div>
            </div>
        </div>

        <!-- Add Tab -->
        <div id="add-tab" class="tab-content">
            <div class="modal-body">
                <h2 style="margin-bottom: 20px; color: #2c3e50;">Yeni Mahkeme Kararƒ± Ekle</h2>
                <div id="addFormMessages"></div>
                <form id="addDecisionForm">
                    <div class="details-section">
                        <h4>Dava Bilgileri</h4>
                        <div class="form-row">
                            <div class="form-group required">
                                <label>Dosya Numarasƒ±</label>
                                <input type="text" id="case_number" placeholder="√∂rn: 2023/245 E., 2023/318 K." required>
                            </div>
                            <div class="form-group required">
                                <label>Mahkeme Adƒ±</label>
                                <input type="text" id="court_name" placeholder="√∂rn: Ankara 5. Asliye Ceza Mahkemesi" required>
                            </div>
                            <div class="form-group required">
                                <label>Karar Tarihi</label>
                                <input type="date" id="decision_date" required>
                            </div>
                        </div>
                    </div>

                    <div class="details-section">
                        <h4>Sanƒ±k Bilgileri</h4>
                        <div class="form-row">
                            <div class="form-group required">
                                <label>Ad Soyad</label>
                                <input type="text" id="defendant_name" required>
                            </div>
                            <div class="form-group required">
                                <label>Baba Adƒ±</label>
                                <input type="text" id="defendant_father" required>
                            </div>
                            <div class="form-group required">
                                <label>Ana Adƒ±</label>
                                <input type="text" id="defendant_mother" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group required">
                                <label>Doƒüum Tarihi</label>
                                <input type="date" id="defendant_birth_date" required>
                            </div>
                            <div class="form-group required">
                                <label>Doƒüum Yeri</label>
                                <input type="text" id="defendant_birth_place" required>
                            </div>
                            <div class="form-group required">
                                <label>TC Kimlik No</label>
                                <input type="text" id="defendant_tc" pattern="[0-9]{11}" maxlength="11" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group required">
                                <label>Adres</label>
                                <input type="text" id="defendant_address" required>
                            </div>
                            <div class="form-group required">
                                <label>Meslek</label>
                                <input type="text" id="defendant_occupation" required>
                            </div>
                            <div class="form-group required">
                                <label>Sabƒ±ka Durumu</label>
                                <select id="defendant_record" required>
                                    <option value="">Se√ßiniz</option>
                                    <option value="Yok">Yok</option>
                                    <option value="Var">Var</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="details-section">
                        <h4>Maƒüdur/Davacƒ± Bilgileri</h4>
                        <div class="form-row">
                            <div class="form-group required">
                                <label>Ad Soyad</label>
                                <input type="text" id="plaintiff_name" required>
                            </div>
                            <div class="form-group required">
                                <label>Baba Adƒ±</label>
                                <input type="text" id="plaintiff_father" required>
                            </div>
                            <div class="form-group required">
                                <label>Ana Adƒ±</label>
                                <input type="text" id="plaintiff_mother" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group required">
                                <label>Doƒüum Tarihi</label>
                                <input type="date" id="plaintiff_birth_date" required>
                            </div>
                            <div class="form-group required">
                                <label>Doƒüum Yeri</label>
                                <input type="text" id="plaintiff_birth_place" required>
                            </div>
                            <div class="form-group required">
                                <label>TC Kimlik No</label>
                                <input type="text" id="plaintiff_tc" pattern="[0-9]{11}" maxlength="11" required>
                            </div>
                        </div>
                        <div class="form-group required">
                            <label>Adres</label>
                            <input type="text" id="plaintiff_address" required>
                        </div>
                    </div>

                    <div class="details-section">
                        <h4>Su√ß Tanƒ±mƒ±</h4>
                        <div class="form-row">
                            <div class="form-group required">
                                <label>Su√ß Adƒ±</label>
                                <input type="text" id="crime_name" placeholder="√∂rn: Basit Yaralama" required>
                            </div>
                            <div class="form-group required">
                                <label>TCK Maddesi</label>
                                <input type="text" id="tck_article" placeholder="√∂rn: TCK m. 86/2" required>
                            </div>
                            <div class="form-group required">
                                <label>Su√ß Kategorisi</label>
                                <select id="crime_category" required>
                                    <option value="">Se√ßiniz</option>
                                    <option value="Ki≈üilere Kar≈üƒ± Su√ßlar">Ki≈üilere Kar≈üƒ± Su√ßlar</option>
                                    <option value="Malvarlƒ±ƒüƒ±na Kar≈üƒ± Su√ßlar">Malvarlƒ±ƒüƒ±na Kar≈üƒ± Su√ßlar</option>
                                    <option value="Kamu G√ºvenliƒüine Kar≈üƒ± Su√ßlar">Kamu G√ºvenliƒüine Kar≈üƒ± Su√ßlar</option>
                                    <option value="Kamu ƒ∞daresine Kar≈üƒ± Su√ßlar">Kamu ƒ∞daresine Kar≈üƒ± Su√ßlar</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group required">
                            <label>Su√ß A√ßƒ±klamasƒ±</label>
                            <textarea id="crime_description" required></textarea>
                        </div>
                        <div class="form-row">
                            <div class="form-group required">
                                <label>Ceza Aralƒ±ƒüƒ±</label>
                                <input type="text" id="penalty_range" placeholder="√∂rn: 4 ay - 1 yƒ±l hapis" required>
                            </div>
                            <div class="form-group required">
                                <label>Uzla≈ütƒ±rma Uygunluƒüu</label>
                                <select id="eligible_for_mediation" required>
                                    <option value="">Se√ßiniz</option>
                                    <option value="true">Evet</option>
                                    <option value="false">Hayƒ±r</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="details-section">
                        <h4>Dava √ñzeti</h4>
                        <div class="form-group required">
                            <label>Olay √ñzeti</label>
                            <textarea id="case_summary" required></textarea>
                        </div>
                    </div>

                    <div class="details-section">
                        <h4>Uzla≈ütƒ±rma Sonucu</h4>
                        <div class="form-row">
                            <div class="form-group required">
                                <label>Uzla≈ütƒ±rma Ba≈üarƒ±lƒ± mƒ±?</label>
                                <select id="mediation_successful" onchange="toggleMediationFields()" required>
                                    <option value="">Se√ßiniz</option>
                                    <option value="true">Evet</option>
                                    <option value="false">Hayƒ±r</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Uzla≈ütƒ±rma Tarihi</label>
                                <input type="date" id="mediation_date">
                            </div>
                        </div>
                        <div id="mediationSuccessFields" style="display: none;">
                            <div class="form-group">
                                <label>Uzla≈üma ≈ûartlarƒ± (Her satƒ±ra bir ≈üart yazƒ±n)</label>
                                <textarea id="agreement_terms" rows="5" placeholder="Sanƒ±k maƒüdurdan √∂z√ºr dilemi≈ütir&#10;Sanƒ±k maƒüdura 5.000 TL tazminat √∂demi≈ütir&#10;..."></textarea>
                            </div>
                            <div class="form-group">
                                <label>Anla≈üma Yerine Getirildi mi?</label>
                                <select id="agreement_fulfilled">
                                    <option value="">Se√ßiniz</option>
                                    <option value="true">Evet</option>
                                    <option value="false">Hayƒ±r</option>
                                </select>
                            </div>
                        </div>
                        <div id="mediationFailFields" style="display: none;">
                            <div class="form-group">
                                <label>Ba≈üarƒ±sƒ±zlƒ±k Nedeni</label>
                                <textarea id="failure_reason" rows="3"></textarea>
                            </div>
                        </div>
                    </div>

                    <div class="details-section">
                        <h4>Karar Gerek√ßeleri</h4>
                        <div class="form-group required">
                            <label>Mahkeme Deƒüerlendirmesi</label>
                            <textarea id="court_evaluation" rows="4" required></textarea>
                        </div>
                        <div class="form-group">
                            <label>Gerek√ßeler (Her satƒ±ra bir gerek√ße yazƒ±n)</label>
                            <textarea id="reasoning" rows="5" placeholder="Su√ß CMK 253/4 kapsamƒ±nda uzla≈ütƒ±rma kapsamƒ±ndadƒ±r&#10;Uzla≈ütƒ±rma usul√ºne uygun ≈üekilde ger√ßekle≈ütirilmi≈ütir&#10;..."></textarea>
                        </div>
                    </div>

                    <div class="details-section">
                        <h4>Karar Sonucu</h4>
                        <div class="form-row">
                            <div class="form-group required">
                                <label>Karar T√ºr√º</label>
                                <select id="decision_type" required>
                                    <option value="">Se√ßiniz</option>
                                    <option value="D√º≈üme Kararƒ±">D√º≈üme Kararƒ±</option>
                                    <option value="Mahkumiyet Kararƒ±">Mahkumiyet Kararƒ±</option>
                                    <option value="Beraat Kararƒ±">Beraat Kararƒ±</option>
                                    <option value="Takipsizlik Kararƒ± (Soru≈üturma Evresi)">Takipsizlik Kararƒ± (Soru≈üturma Evresi)</option>
                                </select>
                            </div>
                            <div class="form-group required">
                                <label>Ana Karar</label>
                                <textarea id="main_decision" rows="2" required></textarea>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Tazminat Miktarƒ± (TL)</label>
                            <input type="number" id="compensation_amount" placeholder="0">
                        </div>
                        <div class="form-group">
                            <label>Notlar</label>
                            <textarea id="notes" rows="3"></textarea>
                        </div>
                    </div>

                    <div style="display: flex; gap: 15px; margin-top: 30px;">
                        <button type="submit" class="btn btn-success" style="flex: 1;">‚úÖ Kararƒ± Kaydet</button>
                        <button type="button" class="btn btn-danger" onclick="resetForm()">üîÑ Formu Temizle</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Stats Tab -->
        <div id="stats-tab" class="tab-content">
            <div style="padding: 30px;">
                <h2 style="margin-bottom: 20px; color: #2c3e50;">üìä Genel ƒ∞statistikler</h2>
                <div id="statsContainer" class="stats-grid"></div>
                
                <div style="margin-top: 40px;">
                    <h3 style="margin-bottom: 15px; color: #2c3e50;">üìà Detaylƒ± Analiz</h3>
                    <div id="detailedStats"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let decisions = [];
        let metadata = {};

        // Load decisions from JSON file
        async function loadDecisions() {
            try {
                const response = await fetch('cmk250_mahkeme_kararlari.json');
                const data = await response.json();
                decisions = data.court_decisions || [];
                metadata = data.metadata || {};
                
                populateCategoryFilter();
                filterDecisions();
                updateStats();
            } catch (error) {
                console.error('Veri y√ºklenirken hata:', error);
                document.getElementById('decisionsContainer').innerHTML = `
                    <div class="error-message">
                        ‚ùå Mahkeme kararlarƒ± y√ºklenirken bir hata olu≈ütu. L√ºtfen 'cmk250_mahkeme_kararlari.json' dosyasƒ±nƒ±n mevcut olduƒüundan emin olun.
                    </div>
                `;
            }
        }

        // Populate category filter dropdown
        function populateCategoryFilter() {
            const categories = [...new Set(decisions.map(d => d.crime_definition?.crime_category).filter(Boolean))];
            const select = document.getElementById('categoryFilter');
            
            categories.forEach(cat => {
                const option = document.createElement('option');
                option.value = cat;
                option.textContent = cat;
                select.appendChild(option);
            });
        }

        // Filter and display decisions
        function filterDecisions() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const mediationFilter = document.getElementById('mediationFilter').value;
            const categoryFilter = document.getElementById('categoryFilter').value;

            let filtered = decisions.filter(decision => {
                const matchesSearch = !searchTerm || 
                    decision.case_number?.toLowerCase().includes(searchTerm) ||
                    decision.identity_information?.defendant?.name?.toLowerCase().includes(searchTerm) ||
                    decision.identity_information?.plaintiff?.name?.toLowerCase().includes(searchTerm) ||
                    decision.crime_definition?.crime_name?.toLowerCase().includes(searchTerm) ||
                    decision.crime_definition?.tck_article?.toLowerCase().includes(searchTerm);

                const matchesMediation = mediationFilter === 'all' ||
                    (mediationFilter === 'success' && decision.mediation_outcome?.mediation_successful === true) ||
                    (mediationFilter === 'failed' && decision.mediation_outcome?.mediation_successful === false);

                const matchesCategory = categoryFilter === 'all' ||
                    decision.crime_definition?.crime_category === categoryFilter;

                return matchesSearch && matchesMediation && matchesCategory;
            });

            displayDecisions(filtered);
        }

        // Display decisions
        function displayDecisions(decisionsToDisplay) {
            const container = document.getElementById('decisionsContainer');
            
            if (decisionsToDisplay.length === 0) {
                container.innerHTML = `
                    <div class="no-results">
                        <div style="font-size: 4em; margin-bottom: 20px;">üìã</div>
                        <h3>Sonu√ß Bulunamadƒ±</h3>
                        <p>Arama kriterlerinize uygun mahkeme kararƒ± bulunamadƒ±.</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = decisionsToDisplay.map(decision => `
                <div class="decision-card" onclick="toggleDetails(${decision.id})">
                    <div class="decision-header">
                        <div class="decision-title">
                            <h3>${decision.crime_definition?.crime_name || 'Belirtilmemi≈ü'}</h3>
                            <p>üìÅ ${decision.case_number} | üèõÔ∏è ${decision.court_name}</p>
                            <p>üìÖ ${decision.decision_date}</p>
                        </div>
                        <div>
                            <span class="badge ${decision.mediation_outcome?.mediation_successful ? 'badge-success' : 'badge-danger'}">
                                ${decision.mediation_outcome?.mediation_successful ? '‚úÖ Uzla≈ütƒ±rma Ba≈üarƒ±lƒ±' : '‚ùå Uzla≈ütƒ±rma Ba≈üarƒ±sƒ±z'}
                            </span>
                        </div>
                    </div>
                    
                    <div class="decision-body">
                        <div class="info-group">
                            <label>üë§ Sanƒ±k</label>
                            <div class="value">${decision.identity_information?.defendant?.name || 'Belirtilmemi≈ü'}</div>
                        </div>
                        <div class="info-group">
                            <label>üë• Maƒüdur/Davacƒ±</label>
                            <div class="value">${decision.identity_information?.plaintiff?.name || 'Belirtilmemi≈ü'}</div>
                        </div>
                        <div class="info-group">
                            <label>‚öñÔ∏è Su√ß</label>
                            <div class="value">${decision.crime_definition?.tck_article || 'Belirtilmemi≈ü'}</div>
                        </div>
                        <div class="info-group">
                            <label>üìã Karar T√ºr√º</label>
                            <div class="value">${decision.decision_outcome?.decision_type || 'Belirtilmemi≈ü'}</div>
                        </div>
                    </div>

                    <div id="details-${decision.id}" class="decision-details">
                        ${generateDecisionDetails(decision)}
                    </div>
                    
                    <div style="text-align: center; margin-top: 15px; color: #3498db; font-weight: 600;">
                        <span id="toggle-text-${decision.id}">‚ñº Detaylarƒ± G√∂ster</span>
                    </div>
                </div>
            `).join('');
        }

        // Generate decision details HTML
        function generateDecisionDetails(decision) {
            return `
                <div class="details-section">
                    <h4>üë§ Kimlik Bilgileri</h4>
                    <div class="details-content">
                        <p><strong>Sanƒ±k:</strong></p>
                        <ul>
                            <li>Ad Soyad: ${decision.identity_information?.defendant?.name || 'Belirtilmemi≈ü'}</li>
                            <li>Baba Adƒ±: ${decision.identity_information?.defendant?.father_name || 'Belirtilmemi≈ü'}</li>
                            <li>Ana Adƒ±: ${decision.identity_information?.defendant?.mother_name || 'Belirtilmemi≈ü'}</li>
                            <li>Doƒüum Tarihi/Yeri: ${decision.identity_information?.defendant?.birth_date || ''} / ${decision.identity_information?.defendant?.birth_place || ''}</li>
                            <li>Adres: ${decision.identity_information?.defendant?.address || 'Belirtilmemi≈ü'}</li>
                            <li>Meslek: ${decision.identity_information?.defendant?.occupation || 'Belirtilmemi≈ü'}</li>
                            <li>Sabƒ±ka: ${decision.identity_information?.defendant?.criminal_record || 'Belirtilmemi≈ü'}</li>
                        </ul>
                        <p><strong>Maƒüdur/Davacƒ±:</strong></p>
                        <ul>
                            <li>Ad Soyad: ${decision.identity_information?.plaintiff?.name || 'Belirtilmemi≈ü'}</li>
                            <li>Baba Adƒ±: ${decision.identity_information?.plaintiff?.father_name || 'Belirtilmemi≈ü'}</li>
                            <li>Ana Adƒ±: ${decision.identity_information?.plaintiff?.mother_name || 'Belirtilmemi≈ü'}</li>
                            <li>Doƒüum Tarihi/Yeri: ${decision.identity_information?.plaintiff?.birth_date || ''} / ${decision.identity_information?.plaintiff?.birth_place || ''}</li>
                            <li>Adres: ${decision.identity_information?.plaintiff?.address || 'Belirtilmemi≈ü'}</li>
                        </ul>
                    </div>
                </div>

                <div class="details-section">
                    <h4>‚öñÔ∏è Su√ß Tanƒ±mƒ±</h4>
                    <div class="details-content">
                        <p><strong>Su√ß Adƒ±:</strong> ${decision.crime_definition?.crime_name || 'Belirtilmemi≈ü'}</p>
                        <p><strong>TCK Maddesi:</strong> ${decision.crime_definition?.tck_article || 'Belirtilmemi≈ü'}</p>
                        <p><strong>Kategori:</strong> ${decision.crime_definition?.crime_category || 'Belirtilmemi≈ü'}</p>
                        <p><strong>A√ßƒ±klama:</strong> ${decision.crime_definition?.crime_description || 'Belirtilmemi≈ü'}</p>
                        <p><strong>Ceza Aralƒ±ƒüƒ±:</strong> ${decision.crime_definition?.penalty_range || 'Belirtilmemi≈ü'}</p>
                    </div>
                </div>

                <div class="details-section">
                    <h4>üìù Dava √ñzeti</h4>
                    <div class="details-content">
                        <p>${decision.case_summary || 'Belirtilmemi≈ü'}</p>
                    </div>
                </div>

                ${decision.procedural_steps && decision.procedural_steps.length > 0 ? `
                <div class="details-section">
                    <h4>üîÑ Usul Adƒ±mlarƒ±</h4>
                    <div class="details-content">
                        <ul>
                            ${decision.procedural_steps.map(step => `<li>${step}</li>`).join('')}
                        </ul>
                    </div>
                </div>
                ` : ''}

                <div class="details-section">
                    <h4>ü§ù Uzla≈ütƒ±rma Sonucu</h4>
                    <div class="details-content">
                        <p><strong>Durum:</strong> ${decision.mediation_outcome?.mediation_successful ? '‚úÖ Ba≈üarƒ±lƒ±' : '‚ùå Ba≈üarƒ±sƒ±z'}</p>
                        <p><strong>Tarih:</strong> ${decision.mediation_outcome?.mediation_date || 'Belirtilmemi≈ü'}</p>
                        ${decision.mediation_outcome?.mediation_successful && decision.mediation_outcome?.agreement_terms ? `
                            <p><strong>Uzla≈üma ≈ûartlarƒ±:</strong></p>
                            <ul>
                                ${decision.mediation_outcome.agreement_terms.map(term => `<li>${term}</li>`).join('')}
                            </ul>
                            <p><strong>Yerine Getirilme:</strong> ${decision.mediation_outcome?.agreement_fulfilled ? '‚úÖ Evet' : '‚ùå Hayƒ±r'}</p>
                        ` : ''}
                        ${!decision.mediation_outcome?.mediation_successful && decision.mediation_outcome?.failure_reason ? `
                            <p><strong>Ba≈üarƒ±sƒ±zlƒ±k Nedeni:</strong> ${decision.mediation_outcome.failure_reason}</p>
                        ` : ''}
                    </div>
                </div>

                <div class="details-section">
                    <h4>üìú Karar Gerek√ßeleri</h4>
                    <div class="details-content">
                        <p><strong>Mahkeme Deƒüerlendirmesi:</strong></p>
                        <p>${decision.decision_rationale?.court_evaluation || 'Belirtilmemi≈ü'}</p>
                        ${decision.decision_rationale?.reasoning && decision.decision_rationale.reasoning.length > 0 ? `
                            <p><strong>Gerek√ßeler:</strong></p>
                            <ul>
                                ${decision.decision_rationale.reasoning.map(reason => `<li>${reason}</li>`).join('')}
                            </ul>
                        ` : ''}
                    </div>
                </div>

                <div class="details-section">
                    <h4>‚öñÔ∏è Karar Sonucu</h4>
                    <div class="details-content">
                        <p><strong>Karar T√ºr√º:</strong> ${decision.decision_outcome?.decision_type || 'Belirtilmemi≈ü'}</p>
                        <p><strong>Ana Karar:</strong> ${decision.decision_outcome?.main_decision || 'Belirtilmemi≈ü'}</p>
                        ${decision.decision_outcome?.penalties?.compensation?.amount ? `
                            <p><strong>Tazminat:</strong> ${decision.decision_outcome.penalties.compensation.amount} (${decision.decision_outcome.penalties.compensation.paid ? '√ñdendi' : '√ñdenmedi'})</p>
                        ` : ''}
                        ${decision.decision_outcome?.penalties?.imprisonment ? `
                            <p><strong>Hapis Cezasƒ±:</strong> ${decision.decision_outcome.penalties.imprisonment.final_penalty}</p>
                            ${decision.decision_outcome.penalties.imprisonment.suspended ? `
                                <p><strong>Erteleme:</strong> Evet (${decision.decision_outcome.penalties.imprisonment.suspension_period})</p>
                            ` : ''}
                        ` : ''}
                        <p><strong>Durum:</strong> ${decision.final_status || 'Belirtilmemi≈ü'}</p>
                    </div>
                </div>

                ${decision.notes ? `
                <div class="details-section">
                    <h4>üìå Notlar</h4>
                    <div class="details-content">
                        <p>${decision.notes}</p>
                    </div>
                </div>
                ` : ''}
            `;
        }

        // Toggle decision details
        function toggleDetails(id) {
            const details = document.getElementById(`details-${id}`);
            const toggleText = document.getElementById(`toggle-text-${id}`);
            
            if (details.classList.contains('expanded')) {
                details.classList.remove('expanded');
                toggleText.textContent = '‚ñº Detaylarƒ± G√∂ster';
            } else {
                details.classList.add('expanded');
                toggleText.textContent = '‚ñ≤ Detaylarƒ± Gizle';
            }
        }

        // Update statistics
        function updateStats() {
            const statsContainer = document.getElementById('statsContainer');
            const detailedStats = document.getElementById('detailedStats');

            const totalDecisions = decisions.length;
            const successfulMediation = decisions.filter(d => d.mediation_outcome?.mediation_successful === true).length;
            const failedMediation = decisions.filter(d => d.mediation_outcome?.mediation_successful === false).length;
            const investigationPhase = decisions.filter(d => d.decision_outcome?.decision_type?.includes('Takipsizlik')).length;
            const prosecutionPhase = decisions.filter(d => d.decision_outcome?.decision_type?.includes('D√º≈üme')).length;

            const compensations = decisions
                .map(d => {
                    const comp = d.decision_outcome?.penalties?.compensation?.amount;
                    if (comp && typeof comp === 'string') {
                        return parseFloat(comp.replace(/[^\d.]/g, ''));
                    }
                    return 0;
                })
                .filter(c => c > 0);
            
            const avgCompensation = compensations.length > 0 
                ? (compensations.reduce((a, b) => a + b, 0) / compensations.length).toFixed(0)
                : 0;

            statsContainer.innerHTML = `
                <div class="stat-card">
                    <h3>Toplam Karar</h3>
                    <div class="value">${totalDecisions}</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #27ae60, #229954);">
                    <h3>Ba≈üarƒ±lƒ± Uzla≈ütƒ±rma</h3>
                    <div class="value">${successfulMediation}</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #e74c3c, #c0392b);">
                    <h3>Ba≈üarƒ±sƒ±z Uzla≈ütƒ±rma</h3>
                    <div class="value">${failedMediation}</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #f39c12, #e67e22);">
                    <h3>Ba≈üarƒ± Oranƒ±</h3>
                    <div class="value">${totalDecisions > 0 ? ((successfulMediation / totalDecisions) * 100).toFixed(1) : 0}%</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #9b59b6, #8e44ad);">
                    <h3>Soru≈üturma Evresi</h3>
                    <div class="value">${investigationPhase}</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #16a085, #138d75);">
                    <h3>Kovu≈üturma Evresi</h3>
                    <div class="value">${prosecutionPhase}</div>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, #34495e, #2c3e50);">
                    <h3>Ortalama Tazminat</h3>
                    <div class="value">${avgCompensation > 0 ? avgCompensation.toLocaleString() + ' ‚Ç∫' : '-'}</div>
                </div>
            `;

            // Category breakdown
            const categories = {};
            decisions.forEach(d => {
                const cat = d.crime_definition?.crime_category || 'Belirtilmemi≈ü';
                categories[cat] = (categories[cat] || 0) + 1;
            });

            detailedStats.innerHTML = `
                <div class="details-content">
                    <h4 style="margin-bottom: 15px;">Su√ß Kategorileri Daƒüƒ±lƒ±mƒ±</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                        ${Object.entries(categories).map(([cat, count]) => `
                            <div class="info-group">
                                <label>${cat}</label>
                                <div class="value">${count} karar (${((count / totalDecisions) * 100).toFixed(1)}%)</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        // Switch tabs
        function switchTab(tab) {
            // Update nav tabs
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.getElementById(`${tab}-tab`).classList.add('active');

            if (tab === 'stats') {
                updateStats();
            }
        }

        // Toggle mediation fields
        function toggleMediationFields() {
            const successful = document.getElementById('mediation_successful').value === 'true';
            document.getElementById('mediationSuccessFields').style.display = successful ? 'block' : 'none';
            document.getElementById('mediationFailFields').style.display = successful ? 'none' : 'block';
        }

        // Handle form submission
        document.getElementById('addDecisionForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formMessages = document.getElementById('addFormMessages');
            formMessages.innerHTML = '';

            // Validate form
            const errors = validateForm();
            if (errors.length > 0) {
                formMessages.innerHTML = `
                    <div class="error-message">
                        <strong>‚ö†Ô∏è L√ºtfen a≈üaƒüƒ±daki hatalarƒ± d√ºzeltin:</strong>
                        <ul style="margin-top: 10px; margin-left: 20px;">
                            ${errors.map(err => `<li>${err}</li>`).join('')}
                        </ul>
                    </div>
                `;
                return;
            }

            // Create new decision object
            const newDecision = {
                id: decisions.length + 1,
                case_number: document.getElementById('case_number').value,
                court_name: document.getElementById('court_name').value,
                decision_date: document.getElementById('decision_date').value,
                identity_information: {
                    defendant: {
                        name: document.getElementById('defendant_name').value,
                        father_name: document.getElementById('defendant_father').value,
                        mother_name: document.getElementById('defendant_mother').value,
                        birth_date: document.getElementById('defendant_birth_date').value,
                        birth_place: document.getElementById('defendant_birth_place').value,
                        tc_id: document.getElementById('defendant_tc').value,
                        address: document.getElementById('defendant_address').value,
                        occupation: document.getElementById('defendant_occupation').value,
                        criminal_record: document.getElementById('defendant_record').value
                    },
                    plaintiff: {
                        name: document.getElementById('plaintiff_name').value,
                        father_name: document.getElementById('plaintiff_father').value,
                        mother_name: document.getElementById('plaintiff_mother').value,
                        birth_date: document.getElementById('plaintiff_birth_date').value,
                        birth_place: document.getElementById('plaintiff_birth_place').value,
                        tc_id: document.getElementById('plaintiff_tc').value,
                        address: document.getElementById('plaintiff_address').value
                    }
                },
                crime_definition: {
                    crime_name: document.getElementById('crime_name').value,
                    tck_article: document.getElementById('tck_article').value,
                    crime_description: document.getElementById('crime_description').value,
                    crime_category: document.getElementById('crime_category').value,
                    penalty_range: document.getElementById('penalty_range').value,
                    eligible_for_mediation: document.getElementById('eligible_for_mediation').value === 'true'
                },
                case_summary: document.getElementById('case_summary').value,
                mediation_outcome: {
                    mediation_successful: document.getElementById('mediation_successful').value === 'true',
                    mediation_date: document.getElementById('mediation_date').value || null
                },
                decision_rationale: {
                    court_evaluation: document.getElementById('court_evaluation').value,
                    reasoning: document.getElementById('reasoning').value.split('\n').filter(r => r.trim())
                },
                decision_outcome: {
                    decision_type: document.getElementById('decision_type').value,
                    main_decision: document.getElementById('main_decision').value,
                    penalties: {
                        compensation: {
                            amount: document.getElementById('compensation_amount').value ? document.getElementById('compensation_amount').value + ' TL' : null
                        }
                    }
                },
                notes: document.getElementById('notes').value || null
            };

            // Add mediation-specific fields
            if (newDecision.mediation_outcome.mediation_successful) {
                newDecision.mediation_outcome.agreement_terms = document.getElementById('agreement_terms').value.split('\n').filter(t => t.trim());
                newDecision.mediation_outcome.agreement_fulfilled = document.getElementById('agreement_fulfilled').value === 'true';
            } else {
                newDecision.mediation_outcome.failure_reason = document.getElementById('failure_reason').value;
            }

            // Add to decisions array
            decisions.push(newDecision);

            // Show success message
            formMessages.innerHTML = `
                <div class="success-message">
                    ‚úÖ Mahkeme kararƒ± ba≈üarƒ±yla eklendi! (ID: ${newDecision.id})
                </div>
            `;

            // Reset form
            setTimeout(() => {
                resetForm();
                switchTab('view');
                filterDecisions();
            }, 2000);
        });

        // Validate form
        function validateForm() {
            const errors = [];

            // Check TC numbers
            const defendantTC = document.getElementById('defendant_tc').value;
            const plaintiffTC = document.getElementById('plaintiff_tc').value;
            
            if (!/^\d{11}$/.test(defendantTC)) {
                errors.push('Sanƒ±k TC Kimlik No 11 haneli olmalƒ±dƒ±r');
            }
            if (!/^\d{11}$/.test(plaintiffTC)) {
                errors.push('Maƒüdur TC Kimlik No 11 haneli olmalƒ±dƒ±r');
            }

            return errors;
        }

        // Reset form
        function resetForm() {
            document.getElementById('addDecisionForm').reset();
            document.getElementById('addFormMessages').innerHTML = '';
            document.getElementById('mediationSuccessFields').style.display = 'none';
            document.getElementById('mediationFailFields').style.display = 'none';
        }

        // Initialize on page load
        window.addEventListener('DOMContentLoaded', () => {
            loadDecisions();
        });
    </script>
</body>
</html>
